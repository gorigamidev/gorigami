---
import { services } from "../../data/services";
import { getLang } from "../../i18n/utils";
import { getLocalizedField } from "../../i18n/helpers";

const lang = getLang();
---

<section id="what-we-build">
	<div class="services-container">
		<div class="section-label" data-i18n="whatWeBuild.label">CAPABILITIES</div>
		<h2 data-i18n="whatWeBuild.title">What we build</h2>

		<div class="services-grid">
			{
				services.map((service) => (
					<div class="service-card">
						<h3 data-i18n-field="name">
							{getLocalizedField(service, "name", lang)}
						</h3>
						<p class="service-tag" data-i18n-field="tag">
							{getLocalizedField(service, "tag", lang)}
						</p>
						<p class="service-description" data-i18n-field="description">
							{getLocalizedField(service, "description", lang)}
						</p>
					</div>
				))
			}
		</div>

		<div class="cta-section">
			<a href="#contact" class="btn-cta">â†’ Let's design your system</a>
		</div>
	</div>
</section>

<script>
	import { getLang } from "../../i18n/utils";
	import { getLocalizedField } from "../../i18n/helpers";
	import { services } from "../../data/services";

	// Update service cards when language changes
	function updateServices() {
		const lang = getLang();
		const cards = document.querySelectorAll(".service-card");

		cards.forEach((card, index) => {
			const service = services[index];
			const nameEl = card.querySelector('[data-i18n-field="name"]');
			const tagEl = card.querySelector('[data-i18n-field="tag"]');
			const descEl = card.querySelector('[data-i18n-field="description"]');

			if (nameEl) nameEl.textContent = getLocalizedField(service, "name", lang);
			if (tagEl) tagEl.textContent = getLocalizedField(service, "tag", lang);
			if (descEl)
				descEl.textContent = getLocalizedField(service, "description", lang);
		});
	}

	// Listen for language changes
	document.addEventListener("click", (e) => {
		const target = e.target as HTMLElement;
		if (target.closest(".lang-btn")) {
			setTimeout(updateServices, 100);
		}
	});
</script>

<style>
	#what-we-build {
		width: 100%;
		padding: 8rem 10%;
		background: var(--paper-white);
		border-top: 1px solid var(--light-gray);
	}

	.services-container {
		max-width: 1200px;
		margin: 0 auto;
	}

	.section-label {
		font-size: 0.75rem;
		font-weight: 600;
		letter-spacing: 0.15em;
		text-transform: uppercase;
		color: var(--sandy-brown);
		margin-bottom: 1.5rem;
	}

	#what-we-build h2 {
		font-size: 2.5rem;
		color: var(--ink-black);
		margin-bottom: 4rem;
		font-weight: 700;
	}

	.services-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: 3rem;
		margin-bottom: 4rem;
	}

	.service-card {
		background: transparent;
		padding: 2rem 0;
		border-top: 1px solid var(--light-gray);
		transition: all 0.2s ease;
	}

	.service-card:hover {
		border-top-color: var(--ink-black);
	}

	.service-card h3 {
		font-size: 1.5rem;
		color: var(--ink-black);
		margin-bottom: 0.5rem;
		font-weight: 600;
	}

	.service-tag {
		font-size: 0.95rem;
		color: var(--mid-gray);
		font-style: italic;
		margin-bottom: 1rem;
		font-weight: 400;
	}

	.service-description {
		font-size: 1rem;
		color: var(--mid-gray);
		line-height: 1.6;
		font-weight: 400;
	}

	.cta-section {
		text-align: left;
		margin-top: 4rem;
		padding-top: 3rem;
		border-top: 1px solid var(--light-gray);
	}

	.btn-cta {
		display: inline-block;
		padding: 1rem 1.5rem;
		background: var(--ink-black);
		color: var(--paper-white);
		font-weight: 500;
		font-size: 1rem;
		text-decoration: none;
		transition: all 0.2s ease;
		border: 1px solid var(--ink-black);
	}

	.btn-cta:hover {
		background: var(--accent-hover);
		transform: translateX(4px);
	}

	@media screen and (max-width: 768px) {
		#what-we-build {
			padding: 5rem 1.5rem;
		}

		#what-we-build h2 {
			font-size: 2rem;
		}

		.services-grid {
			grid-template-columns: 1fr;
			gap: 2rem;
		}

		.service-card {
			padding: 1.5rem 0;
		}

		.service-card h3 {
			font-size: 1.3rem;
		}
	}
</style>
