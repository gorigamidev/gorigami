---
import NavBar from "../components/common/NavBar.astro";
import FooterMain from "../components/common/FooterMain.astro";
import Toast from "../components/common/Toast.astro";
import { ClientRouter } from "astro:transitions";
// Use local fonts via fontsource for privacy and performance
import "@fontsource-variable/urbanist";
import "@fontsource-variable/inter";

interface Props {
	title: string;
	description?: string;
}

const { title, description } = Astro.props;
const defaultDescription = "Gorigami. Small teams crafting custom digital systems that scale. From startups to enterprise, we build ERPs, e-commerce, APIs, and MVPs with craft and clarity.";
const metaDescription = description || defaultDescription;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="description"
			content={metaDescription}
		/>
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/x-x-icon" href="https://res.cloudinary.com/gorigami/image/upload/v1769109708/gorigamiland/favicon_mupwkp.ico" />
		<link rel="sitemap" href="/sitemap-index.xml" />
		<link rel="canonical" href={new URL(Astro.url.pathname, Astro.site)} />

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={Astro.url} />
		<meta property="og:title" content={title} />
		<meta
			property="og:description"
			content={metaDescription}
		/>
		<meta property="og:image" content="https://res.cloudinary.com/gorigami/image/upload/v1769109709/gorigamiland/ggtra_xrwusg.png" />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta property="twitter:url" content={Astro.url} />
		<meta property="twitter:title" content={title} />
		<meta
			property="twitter:description"
			content={metaDescription}
		/>
		<meta property="twitter:image" content="https://res.cloudinary.com/gorigami/image/upload/v1769109709/gorigamiland/ggtra_xrwusg.png" />

		<!-- Structured Data (JSON-LD) -->
		<script is:inline type="application/ld+json">
			{
				"@context": "https://schema.org",
				"@type": "Organization",
				"name": "Gorigami",
				"url": "https://gorigami.xyz",
				"logo": "https://res.cloudinary.com/gorigami/image/upload/v1769109709/gorigamiland/ggtra_xrwusg.png",
				"description": metaDescription,
				"contactPoint": {
					"@type": "ContactPoint",
					"telephone": "+57-305-719-7012",
					"contactType": "sales",
					"email": "develop@gorigami.xyz",
					"areaServed": "World"
				},
				"sameAs": [
					"https://www.linkedin.com/company/gorigami",
					"https://github.com/gorigamidev"
				]
			}
		</script>

		<!-- CRITICAL: i18n must run BEFORE anything else to prevent flash -->
		<script is:inline>
			// Immediately detect and set language from localStorage ONLY
			(function () {
				// Get language from localStorage (default to EN)
				let lang = localStorage.getItem("gorigami-lang");

				// Only accept 'es', everything else defaults to 'en'
				if (lang !== "es") {
					lang = "en";
				}

				// Set HTML lang attribute immediately
				document.documentElement.lang = lang;

				console.log("[i18n] Language on page load:", lang);
			})();
		</script>

		<!-- Google tag (gtag.js) -->
		<script
			is:inline
			async
			src="https://www.googletagmanager.com/gtag/js?id=G-ERFZ1FECC9"></script>
		<script is:inline>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag("js", new Date());
			gtag("config", "G-ERFZ1FECC9");
		</script>

		<!-- Initialize translations after DOM loads -->
		<script>
			import { initI18n } from "../i18n/utils";

			// Initialize i18n translations on page load
			if (document.readyState === "loading") {
				document.addEventListener("DOMContentLoaded", initI18n);
			} else {
				initI18n();
			}

			// CRITICAL: Re-initialize translations on View Transitions navigation
			// This ensures language persists when navigating between pages
			document.addEventListener("astro:page-load", () => {
				console.log(
					"[i18n] Page navigated via View Transitions - re-initializing",
				);
				initI18n();
			});
		</script>
		<!-- End Google tag (gtag.js) -->
		<ClientRouter />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body>
		<main id="landing">
			<NavBar />
			<slot />
			<FooterMain />
			<Toast />
		</main>
	</body>
</html>

<style is:global>
	/* global styles - Brand Lineage: minimal, intentional, calm */

	/* UI Fonts - Imports handled via @fontsource-variable in frontmatter */

	/* Gorigami Logo Font - only for brand mark */
	@font-face {
		font-family: "Nautilus";
		src: url("/font/Nautilus.otf") format("opentype");
		font-weight: normal;
		font-style: normal;
		font-display: swap;
	}

	/* UI Fonts */

	:root {
		--logo-font: "Nautilus", serif;
		--heading-font: "Urbanist Variable", system-ui, sans-serif;
		--body-font: "Inter Variable", system-ui, sans-serif;
		font-size: 16px;

		/* Gorigami Brand Color System: 70% white, 25% dark, 5% accent */

		/* Primary Dark - Midnight Violet */
		--midnight-violet: #16091d;
		--midnight-violet-soft: #2a1d31;

		/* Primary Light - Smoke */
		--smoke: #f0f0ef;
		--paper-white: #ffffff;

		/* Accent - Sandy Brown */
		--sandy-brown: #ffa454;
		--sandy-brown-hover: #ff9340;

		/* Light Accent - Lavender Mist */
		--lavender-mist: #f3f2ff;

		/* Supporting Grays */
		--mid-gray: #6b6b6b;
		--light-gray: #e0e0df;

		/* Semantic Aliases (70/25/5 rule) */
		--ink-black: var(--midnight-violet);
		--off-white: var(--smoke);
		--accent: var(--sandy-brown);
		--accent-hover: var(--sandy-brown-hover);

		/* Deprecated - keeping for backward compatibility */
		--dark-color: var(--midnight-violet);
		--white-base: var(--paper-white);
		--text-dark: var(--midnight-violet);
		--text-light: var(--mid-gray);
	}
	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
		scroll-behavior: smooth;
	}
	a {
		text-decoration: none;
		color: inherit;
	}
	body {
		background-color: var(--smoke);
		color: var(--midnight-violet);
		font-family: var(--body-font);
		line-height: 1.6;
	}
	ul {
		list-style: none;
	}
	main {
		display: flex;
	}
	#landing {
		position: relative;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		font-family: var(--body-font);
	}
	h1,
	h2,
	h3,
	h4,
	h5,
	h6 {
		font-family: var(--heading-font);
		font-weight: 700;
		line-height: 1.2;
	}
	#logo {
		font-family: var(--logo-font);
		font-weight: normal;
	}
	#links {
		font-family: var(--body-font);
	}
</style>
